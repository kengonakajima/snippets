画像の圧縮速度の比較をします。

画像サイズは、512x384など自由に変えれます。コードを見て下さい。

結果は以下のように表示されます。

img:0.000470 png:0.005316 pngsz:882 snp:0.000073 snpsz:27971 lz4:0.000919 lz4sz:17418 jpeg:0.001303
img:0.000446 png:0.005676 pngsz:882 snp:0.000057 snpsz:27971 lz4:0.000878 lz4sz:17418 jpeg:0.001236
img:0.000456 png:0.005433 pngsz:882 snp:0.000070 snpsz:27971 lz4:0.000875 lz4sz:17418 jpeg:0.001250
img:0.000456 png:0.005235 pngsz:882 snp:0.000068 snpsz:27971 lz4:0.000866 lz4sz:17418 jpeg:0.001189
img:0.000460 png:0.005113 pngsz:882 snp:0.000073 snpsz:27971 lz4:0.000848 lz4sz:17418 jpeg:0.001380


imgは画像自体を作るために必要な時間です。単位は秒なので、 0.000460というのは、0.46ミリ秒です。
pngはPNG圧縮に必要だった時間です。上の例だと5ミリ秒。画像作成よりも10倍遅い。
pngszはpngのサイズ。882バイトです。
snpは同じ画像をSnappyを使って圧縮した場合です。0.07ミリ秒。画像作成よりも数倍速いです。
ただしサイズが約28KBと大きくなっています。PNGに対して30倍以上。グラデーションの仕方によっては、
もっと大きくなり、簡単に最悪に近いサイズになります。
lz4はLZ4を使った場合の時間。0.8ミリ秒。Snappyより10倍遅く、サイズは17KBと余り変わりません。
jpegは約1ミリ秒。サイズは上のログには出ていないですが画質が75のときは、5882バイトでした。
画質を上げるとどんどんサイズは大きく、時間は少し増えます。
SnappyとLZ4は、写真のような画像や、グラデーションのかかった絵を圧縮すると、
ほぼ最悪ケース(生画像サイズと同じ)になるので、かなり使いづらいことがわかりました。

毎秒60フレームを送信しようとする場合、
画像ができてから、圧縮にかかる時間は1フレームあたり最悪でも16ミリ秒、
できればもっと小さくおさえる必要があります。

そのためには、libjpegを選ぶ必要がありそうです。
送信しようとしてるゲームの内容が、ほとんど黒背景だというような場合はSnappyやLZ4でも可能です。







