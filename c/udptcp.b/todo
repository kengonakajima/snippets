

640byte クライアントから送信 -> 512、 128、 と2回にわけてよみこみ ->
それを640バイトで送信。 ->クライアントは110,110,110,110,72の計512バイ
トを読みこんだ。が、次の128バイトが来ない。


まだ再送はなし。一回作りなおすとよい。


バッファーを1本で持って、送るときの最大を決めてしまう方がいいと思う。
そのほうがプログラムは簡単になるだろう。1本で持つときは再送のための
情報は

* ストリームの何バイト目から何バイト目までの情報を送信したのか

を連続的に記憶しておいて、さらに

* バッファの先頭はストリームの何バイト目なのか

を記憶しておく必要がある。で好きなように送信する。

writeは、単にバッファーにappendするだけで、sendtoするときに
分割するのだ。

受信側は、 普通にACKを送信する。送信がわにACKがきたら、
送信ログがもっている「ackがきたフラグ」を立てる。
ストリームのいちばん古いところ用の送信ログのためのackがきたら、
ストリームをずらすと同時に、その送信ログのエントリを空ける。




