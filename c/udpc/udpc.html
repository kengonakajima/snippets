<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html> <head>
<title>UDP Circuit</title>
</head>

<body>
<h1>UDPCircuit</h1>

UDP上でバーチャルサーキットを作るのだ

<h2>理想</h2>
インターネット上にバーチャルなホストを設定し、
それらの間でUDPを使ってバーチャルサーキットを実現する。



<h2>かんがえかた</h2>

バーチャルホスト AはIPAddress Ai と ポート番号 Ap のふたつの情報で特定される。
それぞれのバーチャルホストはバーチャルポート Avp を複数もつ。
<br><bR>

ここで実現したいバーチャルサーキットとは、
(Ai Ap Avp) と (Bi Bp Bvp) を両端とするコネクションのことであり、
このコネクションを通して、 信頼性の高いストリームを実現する。

<br><br>
なお、UDPCircuitではWell known portとして、9001番を使う。
アドレスはすべてデフォルトを使う。


<h2>インターフェイス</h2>
ここではアプリケーションプログラムから、バーチャルホスト間の
コネクションを使う通信を実現する方法を説明する。
クライアント、サーバーで明確に区別している。

<br><br>
サーバー側
<ol>
  <LI>まずライブラリを初期化する。
	  <code>int UDPCInit( unsigned short port )</code>
	  すべての初期化をする。
	  この関数がブロックすることはない。
	  portは、使うポートを指定する。

  <LI>次に、頻繁にくりかえす(1秒に数回以上)ループの中で以下の関数を毎回呼びだす。
	  <code>void UDPC(void)</code>
	  この中では実際にUDPを使ってネットワークI/Oをおこなう。
	  この関数がブロックすることはない。
	  
  <LI>ネットワーク接続要求があったら、UDPCライブラリは内部に要求をため
	  ていくが、その要求があるかどうかを以下の関数でしらべる。
	  <code>int UDPCAccept(void)</code>
	  この関数が0より大きい値をかえせば、接続要求がきていて、接続を受けい
	  れたことを意味する。値の意味は、バーチャルfdであり、今後のバーチャ
	  ルサーキットに対するアクセスのときにつかう。
	  0をかえしたら、接続要求がきていないことを意味し、負はエラーを意
	  味する。この関数はノンブロックである。

  <LI>UDPCに書きこむには
	  <code>int UDPCWrite( int vfd , char *data, int len )</code>
	  を使う。読みこむには
	  <code>int UDPCRead( int vfd , char*data , int len )</code>
	  を使う。これらの関数はすべてノンブロックである。
	  読みこみ、書きこみできた場合には、そのバイト数をかえす。

	  
  <LI>UDPCをクローズするには
	  <code>void UDPCClose( int vfd )</code>
	  を使う。

  <LI>UDPC内で最後に起きたエラーを得るには
	  <code>int UDPCLastError(void)</code>をつかう。
	  
</ol>
くらいあんと側
<ol>
  <LI>まずライブラリを初期化する。サーバーの項目とおなじ。
  <LI><code>UDPC()</code>についてもサーバーと同じ。
  <LI>バーチャルホストに接続したい場合は以下の関数を使う。
	  <code>int UDPCConnect( char *ipaddr , unsigned short port )</code>
	  この関数は接続に成功すると0より大きい値を返す。
	  この値はvfdである。今後のアクセスに使う。
	  エラーのときは負の値をかえす。
	  この関数はブロックする。
	  ちなみに、サーバー側でも、Connectして誰かに接続できるぞ。
	  
  <LI>接続できたら、あとはUDPCWrite,UDPCReadが使える。

  <LI>ちなみに、クライアント側でも、Acceptして接続を受けることができる
	  ぞ。
</oL>


<h2>実装</h2>

バッファーを表でもって、その表へのindexがvfdである。
パケットには、送り主のvfd , 送り先のvfdの両方を書く。
ただしconnectするときのSYNパケットには送り先のvfd
を書きこむことができないので、0にして送信する。
vfdが0のパケットを受信したら、表の空きをさがして、
あたらしいエントリを確保し、そのvfdをかえす。





<hr>
<address></address>
<!-- hhmts start -->
Last modified: Sat Jul 25 03:54:52 JST 1998
<!-- hhmts end -->
</body> </html>
